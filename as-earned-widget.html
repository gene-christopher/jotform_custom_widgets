<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>As Earned Agent Lookup Widget - Safe Version</title>
    <style>
        .agent-lookup-container {
            max-width: 400px;
            margin: 20px auto;
            padding: 20px;
            border: 2px solid #007cba;
            border-radius: 8px;
            background-color: #f8f9fa;
            font-family: Arial, sans-serif;
        }
        
        .agent-lookup-container h3 {
            color: #007cba;
            margin-top: 0;
            text-align: center;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        
        .input-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            box-sizing: border-box;
        }
        
        .lookup-button {
            width: 100%;
            padding: 12px;
            background-color: #007cba;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            margin-bottom: 15px;
        }
        
        .lookup-button:hover {
            background-color: #005a8b;
        }
        
        .lookup-button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        
        .agent-info {
            display: none;
            padding: 15px;
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 4px;
            margin-bottom: 15px;
        }
        
        .agent-info.show {
            display: block;
        }
        
        .agent-name {
            font-size: 18px;
            font-weight: bold;
            color: #155724;
            margin-bottom: 5px;
        }
        
        .agent-code {
            color: #6c757d;
            font-size: 14px;
        }
        
        .error-message {
            display: none;
            padding: 15px;
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 4px;
            color: #721c24;
            margin-bottom: 15px;
        }
        
        .error-message.show {
            display: block;
        }
        
        .loading {
            display: none;
            text-align: center;
            color: #007cba;
            font-style: italic;
        }
        
        .loading.show {
            display: block;
        }
        
        .debug-info {
            margin-top: 15px;
            padding: 10px;
            background-color: #e9ecef;
            border-radius: 4px;
            font-size: 12px;
            color: #495057;
        }
    </style>
</head>
<body>
    <div class="agent-lookup-container">
        <h3>Agent Lookup Widget</h3>
        
        <div class="input-group">
            <label for="as_earned_AgentCode">Enter Agent Code:</label>
            <input type="text" id="as_earned_AgentCode" placeholder="Enter agent code here">
        </div>
        
        <button class="lookup-button" id="lookupButton" type="button" onclick="lookupAgent()">
            Look Up Agent
        </button>
        
        <div class="loading" id="loading">
            Looking up agent...
        </div>
        
        <div class="agent-info" id="agentInfo">
            <div class="agent-name" id="agentName">Agent Name</div>
            <div class="agent-code" id="agentCodeDisplay">Agent Code</div>
        </div>
        
        <div class="error-message" id="errorMessage">
            Agent not found. Please check the agent code and try again.
        </div>
        
        <div class="debug-info" id="debugInfo">
            <strong>Safe Custom Widget Implementation</strong><br>
            This widget should not interfere with form submission.<br>
            <br>
            <strong>Status:</strong> Ready<br>
            <strong>Widget Value:</strong> <span id="widgetValue">None</span>
        </div>
    </div>

    <script>
        // Safe Custom Widget Implementation
        console.log('As Earned Agent Lookup Widget Safe: Initialized');
        
        // Store the current agent name for submission
        let currentAgentName = '';
        let currentAgentCode = '';
        
        // Minimal JotForm integration - only what's absolutely necessary
        if (window.JFCustomWidget) {
            console.log('As Earned Agent Lookup Widget Safe: JotForm API available');
            
            // Only subscribe to ready event
            JFCustomWidget.subscribe("ready", function() {
                console.log('As Earned Agent Lookup Widget Safe: Widget ready');
                updateDebugInfo('Widget ready');
            });
            
            // Subscribe to submit event with minimal code
            JFCustomWidget.subscribe("submit", function() {
                console.log('As Earned Agent Lookup Widget Safe: Form submitting');
                
                if (currentAgentName) {
                    const dataToSend = {
                        valid: true,
                        value: currentAgentName
                    };
                    
                    console.log('As Earned Agent Lookup Widget Safe: Sending:', dataToSend);
                    JFCustomWidget.sendSubmit(dataToSend);
                } else {
                    console.log('As Earned Agent Lookup Widget Safe: No agent name to send');
                }
            });
            
        } else {
            console.log('As Earned Agent Lookup Widget Safe: JotForm API not available');
        }
        
        function lookupAgent() {
            const agentCode = document.getElementById('as_earned_AgentCode').value.trim();
            
            if (!agentCode) {
                showError('Please enter an agent code');
                return;
            }
            
            console.log('As Earned Agent Lookup Widget Safe: Looking up:', agentCode);
            
            // Show loading state
            showLoading(true);
            hideError();
            hideAgentInfo();
            
            // Use test data
            const testData = {
                '12345': 'Aaron Holub',
                '67890': 'Jane Smith',
                '11111': 'John Doe'
            };
            
            // Simulate lookup
            setTimeout(() => {
                if (testData[agentCode]) {
                    const agentName = testData[agentCode];
                    console.log('As Earned Agent Lookup Widget Safe: Found:', agentName);
                    
                    // Store for submission
                    currentAgentName = agentName;
                    currentAgentCode = agentCode;
                    
                    // Display in widget
                    displayAgentInfo(agentName, agentCode);
                    updateDebugInfo('Found: ' + agentName);
                    
                } else {
                    console.log('As Earned Agent Lookup Widget Safe: Not found');
                    currentAgentName = '';
                    currentAgentCode = '';
                    showError('Agent not found. Try: 12345, 67890, or 11111');
                    updateDebugInfo('Not found');
                }
                
                showLoading(false);
            }, 500);
        }
        
        function displayAgentInfo(agentName, agentCode) {
            document.getElementById('agentName').textContent = agentName;
            document.getElementById('agentCodeDisplay').textContent = 'Code: ' + agentCode;
            document.getElementById('agentInfo').classList.add('show');
        }
        
        function showLoading(show) {
            const loading = document.getElementById('loading');
            const button = document.getElementById('lookupButton');
            
            if (show) {
                loading.classList.add('show');
                button.disabled = true;
                button.textContent = 'Looking up...';
            } else {
                loading.classList.remove('show');
                button.disabled = false;
                button.textContent = 'Look Up Agent';
            }
        }
        
        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.classList.add('show');
        }
        
        function hideError() {
            document.getElementById('errorMessage').classList.remove('show');
        }
        
        function hideAgentInfo() {
            document.getElementById('agentInfo').classList.remove('show');
        }
        
        function updateDebugInfo(message) {
            const debugDiv = document.getElementById('debugInfo');
            const widgetValueSpan = document.getElementById('widgetValue');
            
            widgetValueSpan.textContent = currentAgentName || 'None';
            
            debugDiv.innerHTML = `
                <strong>Safe Custom Widget Implementation</strong><br>
                This widget should not interfere with form submission.<br>
                <br>
                <strong>Status:</strong> ${message}<br>
                <strong>Widget Value:</strong> ${currentAgentName || 'None'}<br>
                <br>
                <strong>Test with: 12345, 67890, or 11111</strong><br>
                <strong>Form submission should work normally!</strong>
            `;
        }
        
        // Initialize
        console.log('As Earned Agent Lookup Widget Safe: Ready');
    </script>
</body>
</html>
